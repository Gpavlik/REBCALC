<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>CRM –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∑–Ω–∏–∂–æ–∫</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f1f1f1;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #008000;
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 1.5em;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    form {
      background: white;
      max-width: 500px;
      margin: 30px auto;
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-bottom: 10px;
      color: #008000;
      font-weight: bold;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding-left: 10px;
      padding-top: 5px;
      padding-bottom: 5px;
    }
    input, select {
      width: 94%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #646464;
      border-radius: 10px;
    }
    button {
      background-color: #008000;
      color: white;
      border: none;
      padding: 10px 15px;
      margin-top: 15px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1em;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    button:hover {
      background-color: #32b63b;
      color: #000000;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    #result {
      max-width: 500px;
      margin: 20px auto;
      padding: 15px;
      border-radius: 6px;
      font-weight: bold;
    }
    .success {
      background: #c9c9c9;
      border: 1px solid #ffffff;
      color: #1b5e20;
    }
    .error {
      background: #ffebee;
      border: 1px solid #ffcdd2;
      color: #b71c1c;
    }
    .suggestions {
      margin-top: 10px;
      padding-left: 15px;
      border-left: 4px solid #008000;
      color: #333;
      font-weight: normal;
    }
  </style>
</head>
<body>

<header>CRM –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∑–Ω–∏–∂–æ–∫</header>

<form id="discountCalc">
  <label>–°—É–º–∞ –∑–∞–∫—É–ø—ñ–≤–ª—ñ (–≥—Ä–Ω): <input type="number" id="purchase"></label>
  <label>–ó–Ω–∏–∂–∫–∞ (%): <input type="number" id="discount"></label>
  <label>–†–æ–∑—Ç–µ—Ä–º—ñ–Ω—É–≤–∞–Ω–Ω—è (–º—ñ—Å): <input type="number" id="months"></label>
  
  <label>–¢–∏–ø –∫–ª—ñ—î–Ω—Ç–∞:
    <select id="clientType">
      <option value="partner">–ü–∞—Ä—Ç–Ω–µ—Ä</option>
      <option value="intermediary">–ü–æ—Å–µ—Ä–µ–¥–Ω–∏–∫</option>
    </select>
  </label>
  
  <label>–õ–æ–∫–∞—Ü—ñ—è (–¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞):
    <select id="location">
      <option value="reagent">–†–µ–∞–≥–µ–Ω—Ç–Ω–∏–π –¥–æ–≥–æ–≤—ñ—Ä</option>
      <option value="district">–†–∞–π–æ–Ω–Ω–∏–π —Ü–µ–Ω—Ç—Ä</option>
      <option value="region">–û–±–ª–∞—Å–Ω–∏–π —Ü–µ–Ω—Ç—Ä</option>
      <option value="kyiv">–ö–∏—ó–≤</option>
    </select>
  </label>
  
  <label>–¢–∏–ø –∑–Ω–∏–∂–∫–∏:
    <select id="type">
      <option value="–Ω–∞–∫–ª–∞–¥–Ω–∞">–í –Ω–∞–∫–ª–∞–¥–Ω—É</option>
      <option value="—Ç–æ–≤–∞—Ä–æ–º">–¢–æ–≤–∞—Ä–æ–º</option>
      <option value="–∑–≤–æ—Ä–æ—Ç–Ω—è_—Ç–æ–≤–∞—Ä–∞–º–∏">–ó–≤–æ—Ä–æ—Ç–Ω—è —Ç–æ–≤–∞—Ä–∞–º–∏</option>
      <option value="—Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç">–°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–æ–º</option>
      <option value="–≥–æ—Ç—ñ–≤–∫–∞">–ì–æ—Ç—ñ–≤–∫–æ—é</option>
    </select>
  </label>
  
  <button type="button" onclick="runCalc()">–†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
</form>

<div id="result"></div>

<script>
const typeAdjustments = {
  "–Ω–∞–∫–ª–∞–¥–Ω–∞": 1.0,
  "—Ç–æ–≤–∞—Ä–æ–º": 0.9,
  "–∑–≤–æ—Ä–æ—Ç–Ω—è_—Ç–æ–≤–∞—Ä–∞–º–∏": 0.8,
  "—Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç": 0.7,
  "–≥–æ—Ç—ñ–≤–∫–∞": 0.7
};

// —à—Ç—Ä–∞—Ñ –∑–∞ —Ä–æ–∑—Ç–µ—Ä–º—ñ–Ω—É–≤–∞–Ω–Ω—è
function installmentPenalty(months) {
  if (months === 0) return 0;
  if (months <= 3) return 1;
  if (months <= 6) return 2;
  if (months <= 12) return 5;
  return 10;
}

// —Ñ—É–Ω–∫—Ü—ñ—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø–ª–∞–Ω—É
function planFactor(d) {
  if (d <= 10) return 100 - d; 
  else {
    let a = -0.16, b = 0.6, c = 100;
    return Math.max(0, a*d*d + b*d + c);
  }
}

function runCalc() {
  let purchase = parseFloat(document.getElementById("purchase").value);
  let discount = parseFloat(document.getElementById("discount").value);
  let months = parseFloat(document.getElementById("months").value);
  let clientType = document.getElementById("clientType").value;
  let location = document.getElementById("location").value;
  let type = document.getElementById("type").value;

  const thresholdsPartner = {"reagent":20000,"district":35000,"region":60000,"kyiv":70000};
  const thresholdsIntermediary = [
    {limit:35000,maxDiscount:10},
    {limit:500000,maxDiscount:15},
    {limit:1000000,maxDiscount:20},
    {limit:2000000,maxDiscount:99}
  ];

  let maxDiscount = 0;
  let resultText = "";
  let cssClass = "success";

  if (clientType === "partner") {
    let minPurchase = thresholdsPartner[location];
    if (purchase < minPurchase) {
      let diff = minPurchase - purchase;
      resultText = `‚ùå –ó–∞–∫—É–ø—ñ–≤–ª—è –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—è.<br>
      üëâ –ü–æ—Ç—Ä—ñ–±–Ω–æ –∑–±—ñ–ª—å—à–∏—Ç–∏ –Ω–∞ ${diff} –≥—Ä–Ω (–¥–æ ${minPurchase} –≥—Ä–Ω).`;
      if (months > 0) resultText += `<br>üëâ –ê–±–æ –∑–º–µ–Ω—à–∏—Ç–∏ —Ä–æ–∑—Ç–µ—Ä–º—ñ–Ω—É–≤–∞–Ω–Ω—è –¥–æ 0 –º—ñ—Å—è—Ü—ñ–≤.`;
      cssClass = "error";
    } else {
      if (type === "–Ω–∞–∫–ª–∞–¥–Ω–∞") {
        if (purchase >= 1000000) {
          maxDiscount = 20;
        } else if (purchase >= 565000) {
          maxDiscount = 15;
        } else {
          maxDiscount = 10;
        }
      } else {
        maxDiscount = (purchase >= 1000000) ? 20 : 10;
      }
    }
  } else {
    for (let t of thresholdsIntermediary) {
      if (purchase >= t.limit) maxDiscount = t.maxDiscount;
    }
  }

  // –∫–æ—Ä–µ–∫—Ü—ñ—è –∑–∞ —Ç–∏–ø–æ–º —ñ —Ä–æ–∑—Ç–µ—Ä–º—ñ–Ω—É–≤–∞–Ω–Ω—è–º
  let adjustedMax = maxDiscount * (typeAdjustments[type] || 1.0);
  adjustedMax -= installmentPenalty(months);
  if (adjustedMax < 0) adjustedMax = 0;

  if (discount > adjustedMax) {
    // –ø—ñ–¥–Ω—è—Ç—Ç—è —Ü—ñ–Ω–∏ –¥–æ–≥–æ–≤–æ—Ä—É
    let expectedDiscountValue = purchase * (discount/100);
    let allowedDiscountValue = purchase * (adjustedMax/100);
    let delta = (expectedDiscountValue - allowedDiscountValue) / typeAdjustments[type];
    let newTotal = purchase + delta;
    let planPercent = planFactor(adjustedMax);
    let planValue = purchase * (planPercent/100);

    // –ø—ñ–¥–∫–∞–∑–∫–∞ –ø—Ä–æ —Ä–æ–∑—Ç–µ—Ä–º—ñ–Ω—É–≤–∞–Ω–Ω—è
    let installmentText = "";
    if (months > 0) {
      installmentText = `- ‚è≥ –ó–º–µ–Ω—à—Ç–µ —Ä–æ–∑—Ç–µ—Ä–º—ñ–Ω—É–≤–∞–Ω–Ω—è –¥–æ 0 –º—ñ—Å—è—Ü—ñ–≤ (–æ–ø–ª–∞—Ç–∞ –ø–æ —Ñ–∞–∫—Ç—É). –£ —Ç–∞–∫–æ–º—É –≤–∏–ø–∞–¥–∫—É –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ–∑–≤–æ–ª–µ–Ω–∞ –∑–Ω–∏–∂–∫–∞ –∑–±—ñ–ª—å—à–∏—Ç—å—Å—è –Ω–∞ ${installmentPenalty(months)}%.<br><br>`;
    }

    // –ø–æ—à—É–∫ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –ø–æ—Ä–æ–≥—É –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É
    let addText = "";
    if (clientType === "partner" && type === "–Ω–∞–∫–ª–∞–¥–Ω–∞") {
      if (purchase < 565000 && discount > 10) {
        let addAmount = 565000 - purchase;
        let nextMax = 15;
        let planNext = planFactor(nextMax);
        let planValueNext = 565000 * (planNext/100);
        addText = `- üì¶ –î–æ–¥–∞–π—Ç–µ —Ç–æ–≤–∞—Ä—É –Ω–∞ ${addAmount} –≥—Ä–Ω (–∑ ${purchase} –¥–æ 565000 –≥—Ä–Ω), —Ç–æ–¥—ñ –º–æ–∂–ª–∏–≤–∞ –∑–Ω–∏–∂–∫–∞ ${nextMax}% –¥–ª—è —Ç–∏–ø—É "–Ω–∞–∫–ª–∞–¥–Ω–∞". –£ –ø–ª–∞–Ω –∑–∞—Ä–∞—Ö—É—î—Ç—å—Å—è ${planValueNext.toFixed(2)} –≥—Ä–Ω (${planNext.toFixed(1)}%).<br><br>`;
      } else if (purchase < 1000000 && discount > 15) {
        let addAmount = 1000000 - purchase;
        let nextMax = 20;
        let planNext = planFactor(nextMax);
        let planValueNext = 1000000 * (planNext/100);
        addText = `- üì¶ –î–æ–¥–∞–π—Ç–µ —Ç–æ–≤–∞—Ä—É –Ω–∞ ${addAmount} –≥—Ä–Ω (–∑ ${purchase} –¥–æ 1000000 –≥—Ä–Ω), —Ç–æ–¥—ñ –º–æ–∂–ª–∏–≤–∞ –∑–Ω–∏–∂–∫–∞ ${nextMax}% –¥–ª—è —Ç–∏–ø—É "–Ω–∞–∫–ª–∞–¥–Ω–∞". –£ –ø–ª–∞–Ω –∑–∞—Ä–∞—Ö—É—î—Ç—å—Å—è ${planValueNext.toFixed(2)} –≥—Ä–Ω (${planNext.toFixed(1)}%).<br><br>`;
      }
    } else {
      for (let t of thresholdsIntermediary) {
        if (t.maxDiscount * (typeAdjustments[type] || 1.0) >= discount) {
          if (t.limit > purchase) {
            let addAmount = t.limit - purchase;
            let nextMax = t.maxDiscount * (typeAdjustments[type] || 1.0);
            let planNext = planFactor(nextMax);
            let planValueNext = t.limit * (planNext/100);
            addText = `- üì¶ –î–æ–¥–∞–π—Ç–µ —Ç–æ–≤–∞—Ä—É –Ω–∞ ${addAmount} –≥—Ä–Ω (–∑ ${purchase} –¥–æ ${t.limit} –≥—Ä–Ω), —Ç–æ–¥—ñ –º–æ–∂–ª–∏–≤–∞ –∑–Ω–∏–∂–∫–∞ ${nextMax.toFixed(1)}% –¥–ª—è —Ç–∏–ø—É "${type}". –£ –ø–ª–∞–Ω –∑–∞—Ä–∞—Ö—É—î—Ç—å—Å—è ${planValueNext.toFixed(2)} –≥—Ä–Ω (${planNext.toFixed(1)}%).<br><br>`;
            break;
          }
        }
      }
    }

    resultText = `‚ùå –ó–Ω–∏–∂–∫–∞ ${discount}% –Ω–µ–º–æ–∂–ª–∏–≤–∞.<br>
    –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ–∑–≤–æ–ª–µ–Ω–æ ${adjustedMax}% –¥–ª—è —Ç–∏–ø—É "${type}" –ø—Ä–∏ —Ä–æ–∑—Ç–µ—Ä–º—ñ–Ω—É–≤–∞–Ω–Ω—ñ ${months} –º—ñ—Å.<br><br>
    <div class="suggestions">
    üëâ –ü—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó:<br>
    ${installmentText}
    ${addText}
    - üí∞ –ó–±—ñ–ª—å—à—Ç–µ —Ñ—ñ–Ω–∞–ª—å–Ω—É —Ü—ñ–Ω—É —É–≥–æ–¥–∏ –Ω–∞ ${delta.toFixed(2)} –≥—Ä–Ω (–¥–æ ${newTotal.toFixed(2)} –≥—Ä–Ω). –£ —Ç–∞–∫–æ–º—É –≤–∏–ø–∞–¥–∫—É —É –ø–ª–∞–Ω –∑–∞—Ä–∞—Ö—É—î—Ç—å—Å—è ${planValue.toFixed(2)} –≥—Ä–Ω (${planPercent.toFixed(1)}%).<br><br>
    - üîÑ –û–±–µ—Ä—ñ—Ç—å –±—ñ–ª—å—à –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–∏–π —Ç–∏–ø –∑–Ω–∏–∂–∫–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ "–í –Ω–∞–∫–ª–∞–¥–Ω—É").<br><br>
    - –Ø–∫—â–æ –∫–ª—ñ—î–Ω—Ç –Ω–∞–ø–æ–ª—è–≥–∞—î ‚Äî —Ä–æ–∑–≥–ª—è–Ω—å—Ç–µ –≤–∞—Ä—ñ–∞–Ω—Ç —Ä–æ–±–æ—Ç–∏ —á–µ—Ä–µ–∑ –ø–æ—Å–µ—Ä–µ–¥–Ω–∏–∫–∞.
    </div>`;
    cssClass = "error";
  } else if (resultText === "") {
    let discountValue = purchase * (discount/100);
    let planPercent = planFactor(discount);
    let planValue = purchase * (planPercent/100);
    resultText = `‚úÖ –ó–Ω–∏–∂–∫–∞ ${discount}% (${discountValue.toFixed(2)} –≥—Ä–Ω).<br>
    –£ –ø–ª–∞–Ω –∑–∞—Ä–∞—Ö—É—î—Ç—å—Å—è ${planValue.toFixed(2)} –≥—Ä–Ω (${planPercent.toFixed(1)}%).`;
    if (planPercent < 90 || discount > 10) cssClass = "error";
  }

  document.getElementById("result").className = cssClass;
  document.getElementById("result").innerHTML = resultText;
}

</script>
</body>
</html>